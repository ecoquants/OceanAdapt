---
title: "Column definitions"
output: html_notebook
---
```{r setup}
library(tidyverse)

units <- tibble(EML::get_unitList())
```

This specific document(col_defs_creation.Rmd) creates the column definitions for the first time.

This document generates a table that can be merged with an attribute table to generate an eml or provide information for a web page.

# Define Possible Units and Column Descriptions for All Regions


# General units – data from a given region have columns which are in one of the following units
# All units must be custom defined or found here: https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/./eml-unitTypeDefinitions.html#StandardUnitDictionary

## add gmex bgsrec column names
```{r}
sample_data <- read_csv(here::here("data_raw", "gmex_BGSREC.csv"), n_max = 6)

col_defs <- tribble(~attributeName, ~col_class, ~attributeDefinition, ~unit,
  "BGSID", "integer", "a unique integer assigned for each entry in the BGSREC table", "dimensionless",
  "CRUISEID", "integer", "a unique integer assigned for each entry in the CRUISES table", "dimensionless", 
  "STATIONID", "integer", "is a unique integer assigned for each entry in the STAREC table.", "dimensionless",
  "VESSEL", "integer", "is a unique integer representing the Vessel name, from the VESSELS table", "dimensionless",
  "CRUISE_NO", "character", "is a four character string usually in the format YYXX. Such as 1304 for year 2013, fourth survey", NA,
  "P_STA_NO","character", "the Pascagoula Station Number. A five character string, using in the format of VVSSSS where VV is the vessel number and SSSS is a sequential count of the stations processed for that survey. The P_STA_NO entry should be unique for each STAREC entry per Cruise. P_STA_NO may repeat for different CRUISEIDS.", NA,
  "CATEGORY", "integer","A one character field which is a code. The program assigns a code to this field based on the first character value of the biocode number. A first position biocode digit which is ‘1’ is assigned a category code of ‘3’. A first position biocode digit which is ‘2’ is assigned a category code of ‘1’. All other first position biocode digits are assigned a category code of ‘2’. It may NOT be blank or null.", "dimensionless", 
  "GENUS_BGS", "character", "A seven character field which contains the genus part of the genus/species name. This field may not be blank and should contain a valid genus name. It may NOT be blank or null.", NA,
  "SPEC_BGS", "character", "a six character field which contains the species part of the genus/species name. It may be blank or null.", NA,
  "BGSCODE", "character","is a one character field which contains a bgs code. Valid values are T,E,C,S,I. It may be blank or null.", NA,
  "CNT", "integer", "a six digit numeric field which represents the number of genus/species sampled. This is an integer field. Value may be blank only when the genus/species was select. It must contain a value > 0 when genus/species was ‘sample’.", "count",
  "CNTEXP","double","an eight digit numeric field which represents one of two possible values. If the genus/species is sampled, this value is the extrapolated count of the genus/species. If the genus/species is a select, this value is the actual number of the genus/species that was selected. It may not be blank or null.", "count",
  "SAMPLE_BGS", "double","a seven character field which must be numeric. This field contains a number which must be in XXX.XXX format and represents weight in kilograms.", "kilograms", 
  "SELECT_BGS", "double", "seven character field which must be numeric. This field contains a number which must be in XXX.XXX format and represents select weight in kilograms. It may be blank or null.", "kilograms",
  "BIO_BGS", "integer", "a 9 digit field containing a number (biocode) which is based on the genus/species name.", "dimensionless",
  "NODC_BGS", "integer", "is a numeric field. This field contains a number which is based on the genus/species name. (Not Implemented/or used currently).", "dimensionless",
  "IS_SAMPLE", "logical", "a one character field which is a code. A ‘Y’ indicates when the genus/species is sampled. Sample records have a value in the count field and the sample field. An ‘N’ indicates the genus/species is select. Select records should have a value in the count expanded field and the select weight field. It may NOT be blank or null. It should contain either ‘Y’ or ‘N’.", NA, 
  "TAXONID", "double", "a numeric field. Not currently utilized.", "dimensionless", 
  "INVRECID", "integer", "a unique integer assigned for each entry in the INVREC table.", "dimensionless")

# standardise col_class
col_defs <- col_defs %>% 
  mutate(col_class = ifelse(col_class == "integer", "numeric", col_class),
         col_class = ifelse(col_class == "double", "numeric", col_class),
         col_class = ifelse(col_class == "logical", "character", col_class), 
         col_class = ifelse(col_class == "date", "character", col_class),
         col_class = ifelse(col_class == "Date", "character", col_class), 
         unit = ifelse(unit == "character", "dimensionless", unit),
         unit = ifelse(unit == "kilograms", "kilogram", unit),
         unit = ifelse(unit == "count", "number", unit),
         unit = ifelse(is.na(unit), "dimensionless", unit))

```

# add gmex_CRUISEs
```{r}

sample_data <- read_csv("https://raw.githubusercontent.com/pinskylab/OceanAdapt/master/data_raw/gmex_CRUISES.csv", n_max = 6)

new <- tribble(~attributeName, ~attributeDefinition, ~col_class, ~unit,
               "YR", "a 4 digit string containing the year of the survey", "character", "dimensionless",
               "SOURCE", "a two digit code for the source (SEAMAP Partner) that collected the data", "numeric", "dimensionless",
               "STARTCRU","contains the date the first station for that survey was sampled", "character", "dimensionless",
               "ENDCRU", "contains the date the last station for that survey was sampled", "character", "dimensionless",
               "TITLE", "contains a descriptive title for the survey", "character", "dimensionless",
               "NOTE","contains a numeric code indicating the status of the survey data. May be NULL", "character", "dimensionless",
               "INGEST_SOURCE","contains the program version (if any) used to export the survey data into a standardized format for importation.", "character", "dimensionless",
"INGEST_PROGRAM_VER", "contains the program version (if any) of the software utilized to import survey data.", "character", "dimensionless")

col_defs <- rbind(col_defs, new) %>% 
  distinct()
```
# Add Alaska strata
```{r}
sample_data <- read_csv("https://raw.githubusercontent.com/pinskylab/OceanAdapt/master/data_raw/ai_strata.csv", n_max = 6)

new <- tribble(~attributeName, ~attributeDefinition, ~col_class, ~unit,
               "NPFMCArea", "region of haul", "character", "dimensionless", 
               "SubareaDescription", "region of haul", "character", "dimensionless", 
               "StratumCode", "RACE database statistical area for analyzing data. Strata were designed using bathymetry and other measures of habitat and are unique to each survey series.", "numeric", "dimensionless", 
               "DepthIntervalm", "range of depths for the stratum", "numeric", "meter",
               "Areakm2", "the area of the stratum", "numeric", "squareKilometers")

col_defs <- rbind(col_defs, new) %>% 
  distinct()
```
# add alaska trawls
```{r}
sample_data <- read_csv("https://raw.githubusercontent.com/pinskylab/OceanAdapt/master/data_raw/ai1983_2000.csv", n_max = 6)

new <- tribble(~attributeName, ~attributeDefinition, ~col_class, ~unit,
               "LATITUDE","The latitude (decimal degrees) at the start of the haul", "numeric", "degree", 
               "LONGITUDE", "The longitude (decimal degrees) at the start of the haul", "numeric", "degree",
               "DATETIME", "This is the date and time at the beginning of the haul; This is the date and time at the beginning of the haul; For groundfish trawl data, this is the on-bottom time which is determined after we have looked at the bottom-contact sensor and net-mensuration plots. ", "character" , "dimensionless",
               "WTCPUE", "Catch weight per area the net swept in KG/HA.", "numeric", "kilogramsPerHectare", 
               "NUMCPUE", "Catch number per area the net swept in number/HA.", "numeric", "dimensionless", 
               "COMMON", "The common name of the marine organism associated with the SCIENTIFIC_NAME","character", "dimensionless", 
               "SCIENTIFIC", "The scientific name of the organism associated with the COMMON_NAME.", "character", "dimensionless", 
               "SID", "Domain: RACE Species Codebook; http://www.afsc.noaa.gov/RACE/groundfish/species_codebook.pdf", "numeric", "dimensionless", 
               "BOT_DEPTH", "Weighted average depth (m) and is calculated by adding GEAR_DEPTH to NET_HEIGHT. Prior to (year), before NET_HEIGHT was regularly measured, this value was obtained using either echosounder or bathythermograph.", "numeric", "meter", 
               "BOT_TEMP", "Weighted average temperature (in tenths of a degree Celsius) measured at the maximum depth of the headrope of the trawl. Null values indicate temperature not recoreded.", "numeric", "celsius",
               "CRUISE", "This is a six-digit number identifying the Cruise number. It is of the form: YYYY99 (where YYYY = year of the cruise; 99 = 2-digit number and is sequential; 01 denotes the first cruise that vessel made in this year, 02 is the second, etc.)", "character", "dimensionless", 
               "HAUL", "This number uniquely identifies a haul within a cruise. It is a sequential number, in chronological order of occurrence.", "numeric", "dimensionless")

col_defs <- rbind(col_defs, new) %>% 
  distinct()
```

## Add NEUS columns
```{r}


# strata columns
strata <- read_csv("https://raw.githubusercontent.com/pinskylab/OceanAdapt/master/data_raw/neus_strata.csv", n_max = 6)

new <- tribble(~attributeName, ~attributeDefinition, ~col_class, ~unit,
               "STRGRP_DESC", "Description of stratum group.", "character", "dimensionless",
               "STRATUM", "A predefined area where a net dredge, or other piece of gear was deployed. Code consists of 2 parts: Stratum group code number (2 bytes) and stratum number (3 bytes). Stratum group refers to if area fished is inshore or offshore North or South of Cape Hatteras or the type of cruise (shellfish, State of MA, offshore deepwater). The stratum number (third and fourth digits of code) refers to area defined by depth zone. See SVDBS.SVMSTRATA. The fifth digit of the code increases the length of the stratum number for revised strata after the Hague Line was established. Stratum group code: 01 = Trawl, offshore north of Hatteras; 02 = BIOM; 03 = Trawl, inshore north of Hatteras; 04 = Shrimp; 05 = Scotian shelf; 06 = Shellfish; 07 = Trawl, inshore south of Hatteras; 08 = Trawl, Offshore south of Hatteras; 09 = MA DMF; 99 = Offshore deepwater (outside the stratified area). A change in Bottom Trawl Stratum for the Gulf of Maine-Bay of Fundy has been in effect since Spring 1987, and may be summarized as follows: Previous strata: 01350; Present strata: 01351, 01352.", "character", "dimensionless",
               "STRATUM_NAME", "Name of stratum area.", "character", "dimensionless",
               "STRATUM_AREA", "Stratum area measured in square nautical miles.", "numeric", "dimensionless",
               "MIDLAT", "Middle latitude in stratum for auditing purposes.", "numeric", "dimensionless",
               "MIDLON", "Middle longitude in stratum for auditing purposes.", "numeric", "dimensionless",
               "MINLAT", "Minimum latitude in stratum for auditing purposes.", "numeric", "dimensionless",
               "MAXLAT", "Maximum latitude in stratum for auditing purposes.", "numeric", "dimensionless",
               "MINLON", "Minimum longitude in stratum for auditing purposes.", "numeric", "dimensionless",
               "MAXLON", "Maximum longitude in stratum for auditing purposes.", "numeric", "dimensionless")

col_defs <- rbind(col_defs, new) %>% 
  distinct()
```
## add neus survdat columns
```{r}
load(here::here("data_raw", "neus_Survdat.RData"))

dput(names(survdat))

new <- tribble(~attributeName, ~attributeDefinition, ~col_class, ~unit,
               "CRUISE6", "Code uniquely identifying cruise. The first four digits indicate the year and the last two digit uniquely identify the cruise within the year. The 5th byte signifies cruises other than groundfish: Shrimp survey = 7 (i.e. 201470), State of Massachusetts survey = 9 (i.e. 201491), Food habits = 5 (i.e.199554)", "character","dimensionless",
               "STATION", "Unique sequential order in which stations have been completed. Hangups and short tows each receive a non-repeated consecutive number.","character", "dimensionless",
               "STRATUM", "A predefined area where a net dredge, or other piece of gear was deployed. Code consists of 2 parts: Stratum group code number (2 bytes) and stratum number (3 bytes). Stratum group refers to if area fished is inshore or offshore North or South of Cape Hatteras or the type of cruise (shellfish, State of MA, offshore deepwater). The stratum number (third and fourth digits of code) refers to area defined by depth zone. See SVDBS.SVMSTRATA. The fifth digit of the code increases the length of the stratum number for revised strata after the Hague Line was established. Stratum group code: 01 = Trawl, offshore north of Hatteras; 02 = BIOM; 03 = Trawl, inshore north of Hatteras; 04 = Shrimp; 05 = Scotian shelf; 06 = Shellfish; 07 = Trawl, inshore south of Hatteras; 08 = Trawl, Offshore south of Hatteras; 09 = MA DMF; 99 = Offshore deepwater (outside the stratified area). A change in Bottom Trawl Stratum for the Gulf of Maine-Bay of Fundy has been in effect since Spring 1987, and may be summarized as follows: Previous strata: 01350; Present strata: 01351, 01352.","character", "dimensionless",
               "TOW", "Sequential number representing order in which station was selected within a stratum.", "character", "dimensionless",
               "SVSPP", "A standard code which represents a species caught in a trawl or dredge. Refer to the SVDBS.SVSPECIES_LIST (if you are looking at the OceanAdapt website, SVSPP.RData)", "character", "dimensionless",
               "CATCHSEX", "Code used to identify species that are sexed at the catch level. See SVDBS.SEX_CODES",  "character", "dimensionless",
               "SVVESSEL", "Standard two character code for a survey vessel. Refer to SVDBS.SV_VESSEL", "character", "dimensionless",
               "YEAR", "a 4 digit string containing the year of the survey", "character", "dimensionless",
               "SEASON", "Season during which the survey occurred. Winter, Spring, Summer, or Fall", "character", "dimensionless",
               "LAT", "The latitude (decimal degrees) at the start of the haul", "numeric", "degree",
               "LON", "The longitude (decimal degrees) at the start of the haul", "numeric", "degree",
               "EST_TOWDATE", "Date and time represented by Eastern Standard Time (EST) for the start of a tow or deployment.", "character", "dimensionless",
               "DEPTH", "Water depth (m) of tow.", "numeric", "meter",
               "SURFTEMP", "Surface temperature of water (degrees Celcius).", "numeric", "celsius",
               "SURFSALIN", "Salinity at water surface in practical salinity units (PSU).", "numeric", "dimensionless",
               "BOTTEMP", "Bottom temperature (degrees Celsius).", "numeric", "celsius", 
               "BOTSALIN", "Bottom salinity in Practical Salinity Units (PSU).", "numeric", "dimensionless",
               "ABUNDANCE", "number of this species caught", "character", "dimensionless",
               "BIOMASS", "weight of this species caught", "character", "dimensionless",
               "LENGTH", "Measured length of species in centimeters (cm). Measure method differs by species.", "numeric", "centimeter",
               "NUMLEN", "number of specimens at a given length", "numeric", "dimensionless", 
               "SCINAME", "Scientific name for a species", "character", "dimensionless", 
               "ITISSPP", "species identifiers used by the Integrated Taxonomic Information System (ITIS)", "character", "dimensionless", 
               "COMNAME", "The common name of the marine organism associated with the SCIENTIFIC_NAME", "character", "dimensionless", 
               "AUTHOR", "The author who described the species", "character", "dimensionless")

col_defs <- rbind(col_defs, new) %>% 
  distinct()

```


# Save the file for future use
```{r}
saveRDS(col_defs, here::here("metadata", "column-definitions.rds"))
```

